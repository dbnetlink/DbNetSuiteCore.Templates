@page
@using DbNetSuiteCore.Enums
@using DbNetSuiteCore.Models

@model DbNetSuiteCore.Samples.ViewModels.SampleModel

@section Title
{
    <p>Welcome to the <b>DbNetSuiteCore</b> samples application. The aim is to demonstrate the capabilities of <b>DbNetSuiteCore</b> in terms of transforming data from different sources into a useable web UI. The samples menu itself uses the <b>Grid</b> control to pull information from the file system to create a dynamic menu from the project Razor pages folder.</p> 
}

@section Control {
@{
        var components = new List<string> { "Grid", "Form", "Select" };

        <div class="d-flex justify-content-between align-items-start">
            <ul class="nav nav-tabs" id="componentTabs" role="tablist">
                @foreach (string component in components)
                {
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(component == components.First() ? "active" : string.Empty)" id="@(component)-tab" data-bs-toggle="tab" data-bs-target="#@(component)" type="button" role="tab" aria-controls="home" aria-selected="true">Razor @(component) Samples</button>
                    </li>
                }
            </ul>
            <a class="btn btn-outline-primary btn-sm ms-2 pull-right" href="/home/index" role="button">MVC Samples</a>
        </div>
        <div class="tab-content" id="componentMenu">
            @foreach (string component in components)
            {
                <div class="tab-pane fade show @(component == components.First() ? "active" : string.Empty)" id="@(component)" role="tabpanel" aria-labelledby="@(component)-tab">
                @{
                    var columns = new List<GridColumn>()
                    {
                        new GridColumn(FileSystemColumn.Name.ToString(), "Sample"),
                        new GridColumn(FileSystemColumn.Content.ToString(), "Summary") { RegularExpression = "<p data-summary>(.*?)</p>"}
                    };
                    var samplesGrid = new GridModel(DataSourceType.FileSystem, $"../Pages/Samples/{component}")
                    {
                        FixedFilter = "(IsDirectory = 1 or Name like '%.cshtml') and Name not in ('Shared','_ViewStart.cshtml','index.cshtml','detail.cshtml', 'renderfile.cshtml')",
                        Columns = columns,
                        ToolbarPosition = ToolbarPosition.Hidden,
                        Caption = $"Razor {component} Samples",
                        RowSelection = RowSelection.None
                    };

                    samplesGrid.ClientEvents[GridClientEvent.CellTransform] = "createLink";
                    @(await DbNetSuiteCore.Control.Create(HttpContext).Render(samplesGrid))
                }

                </div>
            }
        </div>
}}
@section Scripts {
    <script type="text/javascript" class="source">
        function createLink(gridControl, args) {
            var tbody = args.cell.closest("tbody")
            var url = tbody.dataset.url.toString().toLowerCase().replace('../pages', '')

               switch (args.columnName.toLowerCase()) {
                case "name":
                    var name = args.cell.dataset.value.toString()
                    if (name.endsWith(".cshtml") && name.startsWith("_") == false) {
                        args.cell.innerHTML = `<a target='_blank' href='${window.location.origin}${url}/${name.replace(".cshtml", "")}'>${name.replace(".cshtml", "")}</a>`
                    }
                    break;
                case "content0":
                    var html = args.cell.innerHTML
                    html = html.replace(/@@RazorHelper.HelpLink\("/g, '<a style="font-weight:bold" href="https://github.com/dbnetlink/DbNetSuiteCore2/wiki/')
                    html = html.replace(/", "/g, '" target="_blank">')
                    html = html.replace(/"\)/g, '</a>')
                    args.cell.innerHTML = html;
                    break;
            }
        }
    </script>
}
