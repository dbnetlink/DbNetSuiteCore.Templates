@page "/Tree/Menu"
@layout SampleLayout
@using DbNetSuiteCore.Blazor.Samples.Components.Layout
@using DbNetSuiteCore.Blazor.Samples.Components.Pages
@using DbNetSuiteCore.Models
@using DbNetSuiteCore.Constants
@using DbNetSuiteCore.Enums
@using Microsoft.AspNetCore.Components.Sections
@inject IHttpContextAccessor httpContextAccessor

<PageTitle>Menu</PageTitle>
@{
    var samplesTree = new TreeModel(DataSourceType.FileSystem, $"../Components/Pages") { FixedFilter = "(IsDirectory = 1 or Name like '%.razor') and Name not in ('Error.razor','Index.razor') and SUBSTRING(Name, 1, 1) <> '_'" };
    samplesTree.Columns = new List<TreeColumn>()
    {
        new TreeColumn(FileSystemColumn.Name.ToString())
    };
    samplesTree.Bind(TreeClientEvent.ItemSelected, "fileSelected");
    samplesTree.Bind(TreeClientEvent.Initialised, "cleanFileNames");

    <div class="main-container">
        <nav class="sidebar">
            @(DbNetSuiteCore.Blazor.Control.Create(httpContextAccessor).Render(samplesTree))
        </nav>

        <iframe name="content-viewport" src="" class="content-frame"></iframe>
    </div>
}}

<script type="text/javascript" class="source">
    function fileSelected(sender, args) {
        let selectedValues = [args.value];
        selectedValues = selectedValues.concat(args.parentValues);
        let url = `/${selectedValues.reverse().join('/').replace('.razor','')}`;
        document.querySelector("iframe.content-frame").src = url;
    }

    function cleanFileNames(sender) {
        sender.getLeafElements().forEach(e => {e.innerText = e.innerText.replace(".razor","")} )
    }
</script>

<SectionContent SectionName="summary">
    <p data-summary>The create views based on the file system structure. In this example to create a simple application menu.</p>
</SectionContent>


    <style>
    .main-container {
        display: flex;
        height: 100vh; /* Viewport Height */
        width: 100vw;  /* Viewport Width */
    }

    .sidebar {
        flex: 1;
        background-color: #f4f4f4;
        border-right: 1px solid #ccc;
        overflow-y: auto; /* Allows scrolling within the list only */
        padding: 20px;
    }

    .content-frame {
        flex: 4;
        border: none;
        height: 100%;
    }
    </style>


